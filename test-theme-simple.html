<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme Toggle Test - Simple</title>
    <link rel="stylesheet" href="/css/apple-style.css">
    <style>
        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }
        .test-container {
            padding: 40px;
            text-align: center;
            transition: background 0.3s ease, color 0.3s ease;
        }
        .test-container h2 {
            margin-bottom: 24px;
            font-size: 2rem;
            transition: color 0.3s ease;
        }
        .test-container p {
            margin: 16px 0;
            font-size: 1.1rem;
            transition: color 0.3s ease;
        }
        .status-box {
            margin: 20px 0;
            padding: 15px;
            border-radius: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        .btn-row {
            margin-top: 30px;
        }
        .btn-row button {
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card test-container">
            <h2>ğŸ¨ ä¸»é¢˜åˆ‡æ¢æµ‹è¯•</h2>

            <div class="status-box">
                <p>å½“å‰ä¸»é¢˜ï¼š<strong id="currentTheme">æ£€æµ‹ä¸­...</strong></p>
                <p>ç³»ç»Ÿåå¥½ï¼š<strong id="systemPreference">æ£€æµ‹ä¸­...</strong></p>
                <p>æœ¬åœ°å­˜å‚¨ï¼š<strong id="localStorageTheme">æ£€æµ‹ä¸­...</strong></p>
            </div>

            <div class="btn-row">
                <button id="themeToggle" class="btn-primary">
                    <span id="themeIcon">ğŸŒ™</span>
                    <span id="themeText">åˆ‡æ¢ä¸»é¢˜</span>
                </button>
                <button class="btn-secondary" onclick="testNotification()">
                    ğŸ“¢ æµ‹è¯•é€šçŸ¥
                </button>
                <button class="btn-secondary" onclick="clearStorage()">
                    ğŸ—‘ï¸ æ¸…é™¤å­˜å‚¨
                </button>
            </div>

            <div class="status-box" style="margin-top: 30px;">
                <p>ğŸ’¡ æç¤ºï¼š</p>
                <p>- ç‚¹å‡»"åˆ‡æ¢ä¸»é¢˜"æŒ‰é’®æŸ¥çœ‹æ•ˆæœ</p>
                <p>- æ£€æŸ¥é¡µé¢èƒŒæ™¯ã€æ–‡å­—å’ŒæŒ‰é’®é¢œè‰²å˜åŒ–</p>
                <p>- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹data-themeå±æ€§</p>
            </div>
        </div>
    </div>

    <script>
        // å¤åˆ¶room.jsçš„ä¸»é¢˜åˆ‡æ¢é€»è¾‘
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const themeText = document.getElementById('themeText');
        const currentThemeSpan = document.getElementById('currentTheme');
        const systemPreferenceSpan = document.getElementById('systemPreference');
        const localStorageThemeSpan = document.getElementById('localStorageTheme');

        function updateThemeDisplay() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const savedTheme = localStorage.getItem('theme');

            currentThemeSpan.textContent = currentTheme === 'dark' ? 'ğŸŒ™ æš—è‰²æ¨¡å¼' : 'â˜€ï¸ äº®è‰²æ¨¡å¼';
            systemPreferenceSpan.textContent = prefersDark ? 'ğŸŒ™ æš—è‰²' : 'â˜€ï¸ äº®è‰²';
            localStorageThemeSpan.textContent = savedTheme ? (savedTheme === 'dark' ? 'ğŸŒ™ æš—è‰²' : 'â˜€ï¸ äº®è‰²') : 'æœªè®¾ç½®';

            themeIcon.textContent = currentTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            themeText.textContent = currentTheme === 'dark' ? 'Light' : 'Dark';
        }

        function setTheme(theme, savePreference = true) {
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.documentElement.style.colorScheme = 'dark';
                if (themeIcon) themeIcon.textContent = 'â˜€ï¸';
                if (themeText) themeText.textContent = 'Light';
                if (themeToggle) themeToggle.title = 'Switch to Light Mode';
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                document.documentElement.style.colorScheme = 'light';
                if (themeIcon) themeIcon.textContent = 'ğŸŒ™';
                if (themeText) themeText.textContent = 'Dark';
                if (themeToggle) themeToggle.title = 'Switch to Dark Mode';
            }

            if (savePreference) {
                localStorage.setItem('theme', theme);
                showToast(`åˆ‡æ¢åˆ° ${theme === 'dark' ? 'ğŸŒ™ æš—è‰²' : 'â˜€ï¸ äº®è‰²'} æ¨¡å¼`, 'success');
            }

            updateThemeDisplay();
            console.log('âœ… ä¸»é¢˜å·²åˆ‡æ¢:', document.documentElement.getAttribute('data-theme'));
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme, true);
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `notification ${type}`;
            toast.textContent = message;

            const container = document.getElementById('notifications') || document.body;
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }

        function testNotification() {
            showToast('ğŸ¨ ä¸»é¢˜åˆ‡æ¢æµ‹è¯•é€šçŸ¥', 'success');
        }

        function clearStorage() {
            localStorage.removeItem('theme');
            showToast('å·²æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„ä¸»é¢˜åå¥½', 'info');
            updateThemeDisplay();
        }

        themeToggle.addEventListener('click', toggleTheme);

        // åˆå§‹åŒ–
        (function init() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme === 'dark') {
                setTheme('dark', false);
            } else if (savedTheme === 'light') {
                setTheme('light', false);
            } else {
                setTheme(prefersDark ? 'dark' : 'light', false);
            }

            updateThemeDisplay();
        })();

        // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
        if (window.matchMedia) {
            const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
            darkModeQuery.addEventListener('change', (e) => {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === null) {
                    setTheme(e.matches ? 'dark' : 'light', false);
                    updateThemeDisplay();
                }
            });
        }
    </script>
</body>
</html>