<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme Toggle Test</title>
    <link rel="stylesheet" href="/css/apple-style.css">
    <style>
        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .test-card {
            padding: 40px;
            text-align: center;
        }
        .test-card h2 {
            margin-bottom: 24px;
            font-size: 2rem;
        }
        .test-card p {
            margin: 16px 0;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card test-card">
            <h2>ğŸ¨ ä¸»é¢˜åˆ‡æ¢æµ‹è¯•</h2>
            <p>å½“å‰ä¸»é¢˜ï¼š<span id="currentTheme">æ£€æµ‹ä¸­...</span></p>
            <p>ç³»ç»Ÿåå¥½ï¼š<span id="systemPreference">æ£€æµ‹ä¸­...</span></p>
            <p>æœ¬åœ°å­˜å‚¨ï¼š<span id="localStorageTheme">æ£€æµ‹ä¸­...</span></p>

            <div style="margin-top: 24px;">
                <button id="themeToggle" class="btn-primary">
                    <span id="themeIcon">ğŸŒ™</span>
                    <span id="themeText">åˆ‡æ¢ä¸»é¢˜</span>
                </button>
            </div>

            <div style="margin-top: 24px;">
                <button class="btn-secondary" onclick="testNotification()">å‘é€æµ‹è¯•é€šçŸ¥</button>
                <button class="btn-secondary" onclick="clearStorage()">æ¸…é™¤æœ¬åœ°å­˜å‚¨</button>
            </div>
        </div>
    </div>

    <script>
        // å¤åˆ¶room.jsçš„ä¸»é¢˜åˆ‡æ¢é€»è¾‘
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const themeText = document.getElementById('themeText');
        const currentThemeSpan = document.getElementById('currentTheme');
        const systemPreferenceSpan = document.getElementById('systemPreference');
        const localStorageThemeSpan = document.getElementById('localStorageTheme');

        function updateThemeDisplay() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const savedTheme = localStorage.getItem('theme');

            currentThemeSpan.textContent = currentTheme === 'dark' ? 'æš—è‰²' : 'äº®è‰²';
            systemPreferenceSpan.textContent = prefersDark ? 'æš—è‰²' : 'äº®è‰²';
            localStorageThemeSpan.textContent = savedTheme ? (savedTheme === 'dark' ? 'æš—è‰²' : 'äº®è‰²') : 'æœªè®¾ç½®';

            themeIcon.textContent = currentTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            themeText.textContent = currentTheme === 'dark' ? 'Light' : 'Dark';
        }

        function setTheme(theme, savePreference = true) {
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.documentElement.style.colorScheme = 'dark';
                if (themeIcon) themeIcon.textContent = 'â˜€ï¸';
                if (themeText) themeText.textContent = 'Light';
                if (themeToggle) themeToggle.title = 'Switch to Light Mode';
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                document.documentElement.style.colorScheme = 'light';
                if (themeIcon) themeIcon.textContent = 'ğŸŒ™';
                if (themeText) themeText.textContent = 'Dark';
                if (themeToggle) themeToggle.title = 'Switch to Dark Mode';
            }

            if (savePreference) {
                localStorage.setItem('theme', theme);
                showToast(`åˆ‡æ¢åˆ° ${theme === 'dark' ? 'æš—è‰²' : 'äº®è‰²'} æ¨¡å¼`, 'info');
            }

            updateThemeDisplay();
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme, true);
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `notification ${type}`;
            toast.textContent = message;

            const container = document.getElementById('notifications') || document.body;
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }

        function testNotification() {
            showToast('ğŸ¨ ä¸»é¢˜åˆ‡æ¢æµ‹è¯•é€šçŸ¥', 'success');
        }

        function clearStorage() {
            localStorage.removeItem('theme');
            showToast('å·²æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„ä¸»é¢˜åå¥½', 'info');
            updateThemeDisplay();
        }

        themeToggle.addEventListener('click', toggleTheme);

        // åˆå§‹åŒ–
        (function init() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme === 'dark') {
                setTheme('dark', false);
            } else if (savedTheme === 'light') {
                setTheme('light', false);
            } else {
                setTheme(prefersDark ? 'dark' : 'light', false);
            }

            updateThemeDisplay();
        })();

        // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
        if (window.matchMedia) {
            const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
            darkModeQuery.addEventListener('change', (e) => {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === null) {
                    setTheme(e.matches ? 'dark' : 'light', false);
                    updateThemeDisplay();
                }
            });
        }
    </script>
</body>
</html>