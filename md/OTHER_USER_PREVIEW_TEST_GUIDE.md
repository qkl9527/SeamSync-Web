# 🔍 其他用户预览功能测试指南

## 📋 测试目标

验证当用户A上传文件时，用户B能否正确看到文件预览内容。

## 🧪 测试步骤

### 测试场景1：文本文件预览

**步骤**：
1. **用户A**：打开浏览器，访问 `http://localhost:3000`
2. **用户A**：创建一个新房间（会生成一个唯一的URL）
3. **用户B**：使用另一个浏览器或另一个标签页，访问用户A提供的房间URL
4. **用户A**：在房间页面，通过粘贴或上传方式上传一个文本文件（如 .txt, .md, .js 文件）
5. **用户B**：观察文件列表，应该能看到：
   - ✅ 文件名称
   - ✅ 文件大小
   - ✅ 文件状态（uploading → completed）
   - ✅ **文本内容的前2行预览**（即使文件还在上传中）

**预期结果**：
- 用户B应该在文件上传过程中就能看到文本预览
- 预览内容应该是文本文件的前2行
- 点击"More"按钮应该能查看完整内容
- 点击"Copy"按钮应该能复制文本内容

### 测试场景2：图片文件预览

**步骤**：
1. 按照场景1的步骤1-3准备两个用户
2. **用户A**：上传一张图片文件（如 .jpg, .png）
3. **用户B**：观察文件列表

**预期结果**：
- 用户B应该能看到图片的缩略图预览
- 图片加载完成后显示完整预览

### 测试场景3：视频文件预览

**步骤**：
1. 按照场景1的步骤1-3准备两个用户
2. **用户A**：上传一个视频文件（如 .mp4, .webm）
3. **用户B**：观察文件列表

**预期结果**：
- 用户B应该能看到视频播放器预览
- 可以播放视频预览

### 测试场景4：其他文件

**步骤**：
1. 按照场景1的步骤1-3准备两个用户
2. **用户A**：上传其他类型的文件（如 .pdf, .docx）
3. **用户B**：观察文件列表

**预期结果**：
- 用户B应该能看到文件名、大小、类型
- 显示"File ready for download"提示

## 🔧 调试信息

### 在浏览器开发者工具中检查

**用户B的浏览器**：
1. 打开开发者工具（F12）
2. 查看 Console 标签页
3. 当用户A上传文件时，应该能看到以下日志：

```
📝 addFileToList called for: [文件名] ID: [ID] Status: uploading
✅ completeFileUpload called for: [文件名] ID: [ID]
✅ File URL: [文件URL]
✅ File status: completed
```

**如果文本文件没有显示预览**：
1. 检查是否有错误信息
2. 检查网络请求是否成功
3. 检查 `updateInlineTextPreview()` 是否被调用

## 🐛 常见问题排查

### 问题1：用户B看不到任何文件
**可能原因**：
- WebSocket连接问题
- 房间URL不正确

**解决方法**：
- 检查浏览器Console是否有WebSocket错误
- 确认用户B访问的是正确的房间URL

### 问题2：用户B看到文件但没有预览
**可能原因**：
- 文件状态还是 uploading
- 异步加载文本内容失败

**解决方法**：
- 等待文件上传完成
- 检查Console是否有网络错误
- 检查文件URL是否可访问

### 问题3：文本预览显示"Error loading content"
**可能原因**：
- 文件URL无法访问
- 网络超时

**解决方法**：
- 检查文件是否正确上传
- 检查服务器文件目录中是否存在该文件

## 📊 测试验证清单

- [ ] **文本文件**：用户B能看到前2行预览
- [ ] **图片文件**：用户B能看到缩略图
- [ ] **视频文件**：用户B能看到播放器预览
- [ ] **其他文件**：用户B能看到文件信息
- [ ] **按钮功能**：Preview、Download、Copy 按钮正常工作
- [ ] **实时同步**：文件状态实时更新
- [ ] **错误处理**：加载失败时优雅降级

## 🎯 成功标准

当用户A上传文件时，用户B应该能够：
1. ✅ 实时看到文件列表更新
2. ✅ 看到文件的预览内容（文本、图片、视频）
3. ✅ 使用 Preview、Download、Copy 功能
4. ✅ 看到文件状态的实时更新

---

**测试完成后**：如果所有测试场景都通过，说明"其他用户预览"功能已经完全修复！🎉